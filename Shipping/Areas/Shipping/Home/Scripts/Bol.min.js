function AppointmentSimilar(n,t){return n.id&&t.id?n.id==t.id:n.CarrierId&&t.CarrierId&&n.start&&t.start&&n.CarrierId==t.CarrierId&&Number(n.start)==Number(t.start)}$(function(){$.widget("ui.selectable",$.ui.selectable,{_mouseStart:function(n){n.ctrlKey=!0;this._super(n)},_mouseDrag:function(n){n.ctrlKey=!0;this._super(n)},_mouseStop:function(n){n.ctrlKey=!0;this._super(n)},_trigger:function(n,t,i){n=="selecting"&&$(i.selecting).addClass("ui-selected");this._super(n,t,i)}})});$(function(){$.widget("bol.calendar",{options:{initialAppointment:null,click:null,change:null},_loader:null,_create:function(){var n,t;this.options.initialAppointment&&this.options.initialAppointment.start&&(n=$.fullCalendar.parseDate(this.options.initialAppointment.start));t=this;this.element.fullCalendar({theme:!0,weekends:!0,height:350,header:{left:"prev,next today",center:"title",right:""},defaultView:"basicWeek",timeFormat:"h:mm TT",allDayDefault:!1,ignoreTimezone:!1,year:n?n.getFullYear():undefined,month:n?n.getMonth():undefined,date:n?n.getDate():undefined,events:function(n,i,r){t._load(n,i,r)},eventClick:function(n,i){if($(i.target).is(".new-event")){t._createAppointment(n);return}if(n){if(n.id){t.selectAppointment(n);t._trigger("click",i,{app:n});return}confirm("This appointment has not yet been created. Would you like to create it now?")&&t._createAppointment(n)}},eventRender:function(n,t){t.attr("title",n.EventToolTip);n.appointmentHtml&&$(".fc-event-inner",t).append(n.appointmentHtml);$(".fc-event-title",t).attr("title",n.AppointmentDateDispaly)}})},_load:function(n,t,i){var r={};r[this.element.attr("data-start-param")]=Math.round(+n/1e3);r[this.element.attr("data-end-param")]=Math.round(+t/1e3);this._loader=$.ajax({url:this.element.attr("data-event-source"),dataType:"json",data:r,traditional:!0,cache:!1,context:this,success:function(n){if(this.options.initialAppointment&&this.options.initialAppointment.id)var t=$.each(n,function(n,t){t.id==_initialAppointment.id&&(t.className="ui-selected")});i(n)},error:function(n){alert(n.responseText);i([])}})},selectAppointment:function(n){n.start&&this.element.fullCalendar("gotoDate",n.start);var t=this;this._loader.done(function(){t._doSelectAppointment(n);t._trigger("change",null,{app:n})})},_doSelectAppointment:function(n){var t=this.element.fullCalendar("clientEvents",function(t){return AppointmentSimilar(n,t)?(t.className="ui-selected",!0):(t.className="",!1)});t.length>0?this.element.fullCalendar("rerenderEvents"):(n.title="New Appointment for Building "+n.BuildingId+", Carrier "+n.CarrierId+".",n.className="ui-state-highlight",n.appointmentHtml='<a href="#" class="new-event">Create<\/a>',this.element.fullCalendar("renderEvent",n))},_createAppointment:function(n){$.ajax({url:this.element.attr("data-create-url"),type:"POST",data:{start:Number(+n.start/1e3),CarrierId:n.CarrierId,BuildingId:n.BuildingId},context:this,success:function(n,t,i){if(i.status==203){alert(n);return}this.element.fullCalendar("refetchEvents");var r=this;this._loader.done(function(){$.type(n.start)=="string"&&(n.start=$.fullCalendar.parseDate(n.start));r.selectAppointment(n)})},error:function(n){alert(n.responseText)}})},rerenderEvents:function(){this.element.fullCalendar("rerenderEvents")},selectedAppointment:function(){var n=this.element.fullCalendar("clientEvents",function(n){if(n.className=="ui-selected")return!0});return n.length==0?null:n[0]}})});$(function(){$.widget("ui.selectable",$.ui.selectable,{options:{dialog:null,appointment:null,matched:null,filter:"tr:not(.ui-state-disabled)",cancel:"a,td:has(.ui-icon-close),td:has(.ui-icon-trash),td:has(.ui-icon-calendar),tr.ui-state-disabled"},_dlg:null,_appointment:null,_create:function(){this._super();var n=this;this._dlg=$("#popup");this._on(this._dlg,{click:"_synchronize"})},_trigger:function(n,t,i){var r,u,f;switch(n){case"stop":r=$("tr",this.element);r.removeClass("ui-state-highlight");u=r.filter(".ui-selected");u.length==1&&(f=this.options.appointment(u));this.refreshPopup(f,t)}this._super(n,t,i)},_synchronize:function(n){if($(n.target).is(".ui-icon-close")){this._dlg.hide("explode");return}if($(n.target).is("a")){if(!this._appointment){alert("Should never happen");return}var t=this;$(this.options.filter,this.element).filter(function(){return AppointmentSimilar(t.options.appointment($(this)),t._appointment)}).addClass("ui-selected");this._trigger("matched",n,{app:t._appointment})}},refreshPopup:function(n,t){var i,r;n?(r=this,i=$(this.options.filter,this.element).filter(function(){return AppointmentSimilar(r.options.appointment($(this)),n)}).length):i=0;i>0?(this._dlg.show().find("span:first").html(i+" matching BOL").end().find("[data-for=title]").text(n.title).end().position({my:"left bottom",at:"left top",of:t}).effect("slide",{},500),this._appointment=n):(this._dlg.hide(),this._appointment=null)}})});$(document).ready(function(){function n(){if($("#dlgCalendar").dialog("isOpen")){var t=$("#tbody tr.ui-selected"),n=$("#calendar").calendar("selectedAppointment")!=null&&t.length>0,i=$("#btnApply").prop("disabled",!n).toggleClass("ui-state-disabled",!n);n?$("span.ui-button-text",i).text("Assign "+t.length+" BOL"):$("span.ui-button-text",i).text("Assign BOL")}}$("#calendar").calendar({initialAppointment:_initialAppointment,click:function(n,t){$("#tbody").selectable("refreshPopup",t.app,n.originalEvent)}});$("#dlgCalendar").dialog({title:"Pick Appointment",autoOpen:_initialAppointment?!0:!1,width:600,height:450,modal:!1,cache:!1,closeOnEscape:!0,dialogClass:"dlg-appointment",position:{my:"right center",at:"right top"},create:function(){var t=this;$("#tbody").bind("selectablestop",function(){n()});$("#calendar").bind("calendarchange",function(){n()})},open:function(){$("#calendar").calendar("rerenderEvents");n()},buttons:[{text:"Assign BOL",id:"btnApply",click:function(){var n=$("#frmBol"),t=$("#calendar").calendar("selectedAppointment"),i;if(!t){alert("No Appointment selected");return}if($("#hfAppointmentId").val(t.id),$("#hfAssignFlag").val("true"),i=$("#tbody tr.ui-selected input:checkbox").clone().prop("checked",!0).appendTo(n),i.length==0){alert("Please select some BOLs");return}$(this).dialog("close");n.submit()}},{text:"Cancel",click:function(){$("#dlgCalendar").dialog("close")}}]});$("#tbody").on("click","a.ui-icon-close",function(){var i,t;return($(this).parents("tr").addClass("ui-selected ui-selectee"),i=$("#tbody tr.ui-selected").map(function(){return $(this).attr("data-shippingid")}).get(),!confirm("Do you want to delete "+i.length+" BOLs"))?!1:(t=$(this).attr("data-url-delete"),t=t.replace("X",i.join(",")),$.ajax({cache:!1,url:t,type:"POST",context:this,success:function(t,i,r){if(r.status==203)return $("#divAjaxError").html(t).addClass("ui-state-highlight"),!1;$("#tbody").find("tr.ui-selected").addClass("text-changed ui-state-disabled").removeClass("ui-selected ui-selectee").find("a").removeClass("ui-icon ui-icon-close ui-icon-calendar").text("Done");n();$("#divAjaxError").html(t).addClass("ui-state-highlight")},error:function(n){alert(n.responseText)}}),!1)}).selectable({appointment:function(n){var t=_appointments[n.attr("data-shippingid")];return t.start=$.fullCalendar.parseDate(t.start),t},dialog:"#automatch",calendar:"#calendar",matched:function(n,t){$("#dlgCalendar").dialog("option","position",{my:"left-bottom",at:"rigth",of:window}).dialog("open");$("#calendar").calendar("selectAppointment",t.app)}});$("table thead input:checkbox").click(function(){var n=$("tbody tr.ui-selectee",$(this).closest("table")),t;n.removeClass("ui-state-highlight");t=$(this).is(":checked");n.toggleClass("ui-selected",t);$("#tbody").trigger("selectablestop")});$("#btnAppointments").click(function(){$("#dlgCalendar").dialog("open")}).button();$("#cbShowScheduled").change(function(){$("#frmShowScheduled").submit()});$("#tbody").on("click","a.ui-icon-calendar",function(n){var u=$(n.target).closest("tr").addClass("ui-selected ui-selectee"),i=$("#tbody tr.ui-selected input:checkbox").clone().prop("checked",!0),t,r;if(!confirm("Do you want to unassign appointment from "+i.length+"BOL"))return!1;if(t=$("#frmBol"),$("#hfAssignFlag").val("false"),r=i.appendTo(t),r.length==0){alert("Please select some BOLs");return}t.submit()})});
//# sourceMappingURL=Bol.min.js.map
